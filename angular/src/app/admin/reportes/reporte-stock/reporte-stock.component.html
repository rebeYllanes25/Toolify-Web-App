<div class="report-container">
  <!-- Header -->
  <div class="report-header">
    <h3><i class="fa-solid fa-boxes-stacked me-2"></i>Reporte de Stock de Productos</h3>
    <p class="text-muted">Monitorea el inventario y disponibilidad de productos</p>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <div class="filters-grid">
      <!-- Categoría -->
      <div class="filter-group">
        <label>
          <i class="fa-solid fa-layer-group me-2"></i>
          Categoría
        </label>
        <select 
          [ngModel]="categoriaSeleccionada" 
          (ngModelChange)="onChangeCategoria($event)"
          class="form-select">
          <option [ngValue]="undefined">Todas las categorías</option>
          <option *ngFor="let cat of categoria" [ngValue]="cat.idCategoria">
            {{ cat.descripcion }}
          </option>
        </select>
      </div>

      <!-- Orden -->
      <div class="filter-group">
        <label>
          <i class="fa-solid fa-arrow-down-short-wide me-2"></i>
          Ordenar por
        </label>
        <select [(ngModel)]="orden" (change)="onChangeOrden()" class="form-select">
          <option value="ASC">
            <i class="fa-solid fa-arrow-up-1-9"></i>
            Ascendente (A-Z)
          </option>
          <option value="DESC">
            <i class="fa-solid fa-arrow-down-9-1"></i>
            Descendente (Z-A)
          </option>
        </select>
      </div>

      <!-- Botón descargar -->
      <div class="filter-group align-self-end">
        <button class="btn-download" (click)="generarPDF()">
          <i class="fa-solid fa-file-pdf me-2"></i>
          Descargar PDF
        </button>
      </div>
    </div>

    <!-- Resumen de estadísticas -->
    <div class="stats-row">
      <div class="stat-card">
        <i class="fa-solid fa-box stat-icon"></i>
        <div class="stat-content">
          <span class="stat-label">Total Productos</span>
          <span class="stat-value">{{ dataSource?.data?.length || 0 }}</span>
        </div>
      </div>
      <div class="stat-card">
        <i class="fa-solid fa-warehouse stat-icon"></i>
        <div class="stat-content">
          <span class="stat-label">Stock Total</span>
          <span class="stat-value">{{ calcularStockTotal() }}</span>
        </div>
      </div>
      <div class="stat-card">
        <i class="fa-solid fa-triangle-exclamation stat-icon warning"></i>
        <div class="stat-content">
          <span class="stat-label">Stock Bajo</span>
          <span class="stat-value text-warning">{{ contarStockBajo() }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-card">
    <table mat-table [dataSource]="dataSource" class="products-table">

      <!-- ID -->
      <ng-container matColumnDef="idProducto">
        <th mat-header-cell *matHeaderCellDef>
          <span class="header-content">
            <i class="fa-solid fa-hashtag me-1"></i>
            ID
          </span>
        </th>
        <td mat-cell *matCellDef="let producto">
          <span class="badge-id">{{ producto.idProducto }}</span>
        </td>
      </ng-container>

      <!-- Nombre -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>
          <span class="header-content">
            <i class="fa-solid fa-tag me-1"></i>
            Producto
          </span>
        </th>
        <td mat-cell *matCellDef="let producto">
          <div class="product-name">
            <i class="fa-solid fa-box me-2"></i>
            <strong>{{ producto.nombre }}</strong>
          </div>
        </td>
      </ng-container>

      <!-- Descripción -->
      <ng-container matColumnDef="descripcion">
        <th mat-header-cell *matHeaderCellDef>
          <span class="header-content">
            <i class="fa-solid fa-align-left me-1"></i>
            Descripción
          </span>
        </th>
        <td mat-cell *matCellDef="let producto">
          <span class="description-text">{{ producto.descripcion }}</span>
        </td>
      </ng-container>

      <!-- Proveedor -->
      <ng-container matColumnDef="proveedor">
        <th mat-header-cell *matHeaderCellDef>
          <span class="header-content">
            <i class="fa-solid fa-truck me-1"></i>
            Proveedor
          </span>
        </th>
        <td mat-cell *matCellDef="let producto">
          <div class="supplier-cell">
            <i class="fa-solid fa-building me-2"></i>
            {{ producto.proveedor.razonSocial }}
          </div>
        </td>
      </ng-container>

      <!-- Categoría -->
      <ng-container matColumnDef="categoria">
        <th mat-header-cell *matHeaderCellDef>
          <span class="header-content">
            <i class="fa-solid fa-layer-group me-1"></i>
            Categoría
          </span>
        </th>
        <td mat-cell *matCellDef="let producto">
          <span class="category-badge">
            {{ producto.categoria.descripcion }}
          </span>
        </td>
      </ng-container>

      <!-- Precio -->
      <ng-container matColumnDef="precio">
        <th mat-header-cell *matHeaderCellDef>
          <span class="header-content">
            <i class="fa-solid fa-dollar-sign me-1"></i>
            Precio
          </span>
        </th>
        <td mat-cell *matCellDef="let producto">
          <span class="price-tag">S/ {{ producto.precio | number:'1.2-2' }}</span>
        </td>
      </ng-container>

      <!-- Stock -->
      <ng-container matColumnDef="stock">
        <th mat-header-cell *matHeaderCellDef>
          <span class="header-content">
            <i class="fa-solid fa-cubes me-1"></i>
            Stock
          </span>
        </th>
        <td mat-cell *matCellDef="let producto">
          <span class="stock-badge" [ngClass]="{
            'stock-high': producto.stock > 50,
            'stock-medium': producto.stock > 10 && producto.stock <= 50,
            'stock-low': producto.stock > 0 && producto.stock <= 10,
            'stock-empty': producto.stock === 0
          }">
            <i class="fa-solid" [ngClass]="{
              'fa-circle-check': producto.stock > 50,
              'fa-circle-exclamation': producto.stock > 10 && producto.stock <= 50,
              'fa-triangle-exclamation': producto.stock > 0 && producto.stock <= 10,
              'fa-circle-xmark': producto.stock === 0
            }"></i>
            {{ producto.stock }} unidades
          </span>
        </td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="fechaRegistrado">
        <th mat-header-cell *matHeaderCellDef>
          <span class="header-content">
            <i class="fa-solid fa-calendar-plus me-1"></i>
            Registro
          </span>
        </th>
        <td mat-cell *matCellDef="let producto">
          <div class="date-cell">
            <i class="fa-solid fa-clock me-1"></i>
            {{ producto.fechaRegistrado | date:'dd/MM/yyyy' }}
            <small class="time-text">{{ producto.fechaRegistrado | date:'HH:mm' }}</small>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnas"></tr>
      <tr mat-row *matRowDef="let row; columns: columnas;" class="table-row"></tr>
    </table>

    <!-- Mensaje cuando no hay datos -->
    <div class="no-data" *ngIf="!dataSource || dataSource.data?.length === 0">
      <i class="fa-solid fa-box-open fa-3x mb-3"></i>
      <p>No se encontraron productos</p>
      <small>No hay productos registrados con los filtros seleccionados</small>
    </div>
  </div>

  <!-- Paginador -->
  <div class="paginator-wrapper">
    <mat-paginator 
      [pageSizeOptions]="[5, 10, 25, 50]" 
      [pageSize]="10" 
      showFirstLastButtons
      aria-label="Selecciona página">
    </mat-paginator>
  </div>
</div>