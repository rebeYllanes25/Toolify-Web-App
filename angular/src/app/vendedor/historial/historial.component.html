<div class="App">
    <div class="min-vh-100 bg-light p-4">
        <div class="container mx-auto">
            <div class="max-w-7xl mx-auto space-y-6">
                <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between gap-3">
                    <div>
                        <h1 class="h3 fw-bold d-flex align-items-center gap-2 mt-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="bi bi-clock-history" aria-hidden="true" role="img"
                                aria-label="Icono de historial">
                                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                                <path d="M3 3v5h5"></path>
                                <path d="M12 7v5l4 2"></path>
                            </svg>
                            Historial de Ventas
                        </h1>

                        <p class="text-secondary mt-1">Consulta y gestiona el historial de todas tus ventas</p>
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-12 col-md-4">
                        <div class="card shadow-sm border rounded-3">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted fw-medium mb-1">Total Ventas</p>
                                    <p class="h3 fw-bold mb-1 text-dark">{{totalVentas}}</p>
                                    <p class="text-muted mb-0">Transacciones registradas</p>
                                </div>
                                <div class="p-3 rounded-circle bg-primary bg-opacity-10">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="bi bi-trending-up text-primary"
                                        aria-hidden="true" role="img" aria-label="Ícono de tendencia al alza">
                                        <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                                        <polyline points="16 7 22 7 22 13"></polyline>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="card shadow-sm border rounded-3">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted fw-medium mb-1">Productos Vendidos</p>
                                    <p class="h3 fw-bold mb-1 text-dark">{{totalProductosVendidos}}</p>
                                    <p class="text-muted mb-0">Unidades totales</p>
                                </div>
                                <div class="p-3 rounded-circle bg-success bg-opacity-10">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="bi bi-box-seam text-success" aria-hidden="true"
                                        role="img" aria-label="Ícono de paquete">
                                        <path
                                            d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z">
                                        </path>
                                        <path d="M12 22V12"></path>
                                        <polyline points="3.29 7 12 12 20.71 7"></polyline>
                                        <path d="m7.5 4.27 9 5.15"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="card shadow-sm border rounded-3">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted fw-medium mb-1">Ingresos Totales</p>
                                    <p class="h3 fw-bold mb-1 text-dark">S/ {{ ingresosTotales | number:'1.2-2' }}</p>
                                    <p class="text-muted mb-0">Monto acumulado</p>
                                </div>
                                <div class="p-3 rounded-circle bg-warning bg-opacity-10">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="bi bi-currency-dollar text-warning"
                                        aria-hidden="true" role="img" aria-label="Ícono de moneda">
                                        <path d="M12 1v22"></path>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7H14a3 3 0 1 1 0 6H7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Listado de ventas -->
                    <div class="d-flex justify-content-center">
                        <div class="card shadow mt-4" style="width: 80%;">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span class="fw-semibold">Listado de Ventas</span>
                                <span class="badge bg-secondary">{{ ventas.length }} resultados</span>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0 text-center">
                                        <thead class="table-light">
                                            <tr>
                                                <th>ID Venta</th>
                                                <th>Fecha</th>
                                                <th>Vendedor</th>
                                                <th>Productos</th>
                                                <th>Total</th>
                                                <th>Estado</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let venta of ventas">
                                                <td class="font-monospace">#{{ venta.idVenta }}</td>
                                                <td>{{ venta.fechaRegistro | date:'mediumDate' }}</td>
                                                <td>{{ venta.usuario.nombres }}</td> <!-- ajusta según tu DTO -->
                                                <td>
                                                    <span class="badge bg-light text-dark">
                                                        {{ venta.detalles.length }} {{ venta.detalles.length > 1 ?
                                                        'productos' : 'producto' }}
                                                    </span>
                                                </td>
                                                <td class="fw-bold">S/. {{ venta.total | number:'1.2-2' }}</td>
                                                <td>
                                                    <span class="badge" [ngClass]="{
          'badge-generado': venta.estado === 'G',
          'badge-entregado': venta.estado === 'E'
        }">
                                                        {{ venta.estado === 'G' ? 'Generado' : 'Entregado' }}
                                                    </span>
                                                </td>

                                                <td>
                                                    <button class="btn btn-outline-secondary btn-sm me-1"
                                                        (click)="abrirDetalle(venta)">
                                                        <i class="bi bi-eye"></i>
                                                    </button>
                                                    <button class="btn btn-outline-secondary btn-sm"
                                                        (click)="descargarPDF(venta)">
                                                        <i class="bi bi-download"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Detalles de Venta -->
                    <div class="modal fade" id="detalleVentaModal" tabindex="-1" aria-labelledby="detalleVentaLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-scrollable">
                            <div class="modal-content">

                                <div class="modal-header">
                                    <h5 class="modal-title" id="detalleVentaLabel">Detalle de Venta #{{
                                        ventaSeleccionada?.idVenta }}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Cerrar"></button>
                                </div>

                                <div class="modal-body" *ngIf="ventaSeleccionada">
                                    <p><strong>Vendedor:</strong> {{ ventaSeleccionada.usuario.nombres }}</p>
                                    <p><strong>Correo:</strong> {{ ventaSeleccionada.usuario.correo }}</p>
                                    <p><strong>Fecha:</strong> {{ ventaSeleccionada.fechaRegistro | date:'short' }}</p>
                                    <p><strong>Total:</strong> S/. {{ ventaSeleccionada.total | number:'1.2-2' }}</p>
                                    <p><strong>Estado: </strong>
                                        <span class="badge" [ngClass]="{
            'badge-generado': ventaSeleccionada.estado === 'G',
            'badge-entregado': ventaSeleccionada.estado === 'E'
          }">
                                            {{ ventaSeleccionada.estado === 'G' ? 'Generado' : 'Entregado' }}
                                        </span>
                                    </p>

                                    <hr>
                                    <h6>Productos</h6>
                                    <table class="table table-sm table-striped">
                                        <thead>
                                            <tr>
                                                <th>Producto</th>
                                                <th>Cantidad</th>
                                                <th>Subtotal</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let det of ventaSeleccionada.detalles">
                                                <td>{{ det.nombreProducto }}</td>
                                                <td>{{ det.cantidad }}</td>
                                                <td>S/. {{ det.subTotal | number:'1.2-2' }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>