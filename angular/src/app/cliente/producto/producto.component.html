<div class="container-xl top-20">
  <!-- Título principal con ícono -->
  <div class="mb-4 mb-md-5">
    <h1 class="display-5 fw-bold text-dark mb-3">Nuestros Productos</h1>
    <p class="fs-5 text-secondary">
      Descubre nuestra selección completa de herramientas y equipos profesionales
    </p>
  </div>


  <div class="row g-4">

    <!-- Sidebar Categorías -->
    <aside class="col-md-3">
      <div class="p-3 border rounded bg-light shadow-sm">
        <h5 class="mb-3 text-uppercase" style="color: #576eaa;">
          <i class="fas fa-list me-2"></i>Categorías
        </h5>

        <div *ngFor="let categoria of categorias" class="form-check mb-2">
          <input class="form-check-input" type="checkbox" [id]="'cat-' + categoria.idCategoria"
            [checked]="filtro.idCategorias.includes(categoria.idCategoria)"
            (change)="onCategoriaChange(categoria.idCategoria, $any($event.target).checked)" />
          <label class="form-check-label" [for]="'cat-' + categoria.idCategoria">
            <i class="fas fa-tag me-1 text-secondary"></i>{{ categoria.descripcion }}
          </label>
        </div>

        <!-- BLOQUE ORDENAMIENTO PRECIO -->
        <hr />
        <h5 class="mb-3 text-uppercase" style="color: #576eaa;">
          <i class="fas fa-sort me-2"></i>Ordenar por precio
        </h5>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="ordenPrecio" id="precioAsc" value="asc"
            [checked]="ordenPrecio === 'asc'" (change)="onOrdenChange('asc')" />
          <label class="form-check-label" for="precioAsc">
            Precio: menor a mayor
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="ordenPrecio" id="precioDesc" value="desc"
            [checked]="ordenPrecio === 'desc'" (change)="onOrdenChange('desc')" />
          <label class="form-check-label" for="precioDesc">
            Precio: mayor a menor
          </label>
        </div>
        <!-- Botón desactivar filtros visible solo si hay filtros -->
        <div *ngIf="hayFiltrosActivos" class="mt-3 d-grid">
          <button type="button" class="btn btn-outline-danger" (click)="desactivarFiltros()">
            Desactivar filtros
          </button>
        </div>
      </div>

    </aside>


    <!-- Productos -->
    <section class="col-md-9">
      <div *ngIf="productos.length === 0" class="text-center text-muted py-5 border rounded">
        <p class="mb-0 fs-5">
          <i class="fas fa-box-open me-2"></i>No hay productos para mostrar.
        </p>
      </div>

      <div class="row">
        <div *ngFor="let producto of productos" class="custom-col mb-4">
          <div class="card h-100 shadow rounded">
            <!-- Imagen base64 o fallback -->
            <img *ngIf="producto.base64Img; else noImageTpl" [src]="'data:image/png;base64,' + producto.base64Img"
              class="card-img-top" [alt]="producto.nombre" style="object-fit: cover; height: 200px;" />
            <ng-template #noImageTpl>
              <img [src]="'assets/productos/P' + producto.idProducto + '.jpg'" class="card-img-top"
                [alt]="producto.nombre" (error)="onImageError($event)" style="object-fit: cover; height: 200px;" />
            </ng-template>

            <div class="card-body d-flex flex-column">
              <!-- Categoria etiqueta -->
              <div class="d-flex justify-content-between align-items-center">
                <span class="badge bg-light text-secondary mb-2" style="font-size: 0.75rem;">
                  {{producto.categoria.descripcion}}
                </span>
                <span *ngIf="producto.stock === 0" class="badge bg-danger text-white ms-2" style="font-size: 0.75rem;">
                  Agotado
                </span>
              </div>

              <!-- Título -->
              <h5 class="card-title fw-bold " style="min-height: 3rem;">{{ producto.nombre }}</h5>

              <!-- Descripción con límite de líneas -->
              <p class="card-text text-muted flex-grow-1"
                style="overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                {{ producto.descripcion }}
              </p>

              <div class="mb-2 d-flex align-items-center">
                <ng-container *ngFor="let star of [1,2,3,4,5]; let i = index">
                  <i class="fas fa-star" [class.text-warning]="i < 4" [class.text-muted]="i >= 4"
                    style="font-size: 0.8rem;"></i>
                </ng-container>
                <small class="text-muted ms-2">(4.0)</small>
              </div>
              <div class="fs-4 fw-bold titulos-Primary mb-3">S/. {{ producto.precio | number: '1.2-2' }}</div>

              <div class="d-flex gap-2">
                <button class="btn btn-outline-secondary flex-fill btn-sm" (click)="verDetalles(producto)">
                  <i class="fas fa-eye me-1"></i> Detalles
                </button>
                <button class="btn btn-primary-custom flex-fill btn-sm" (click)="agregarAlCarrito(producto)"
                  [disabled]="producto.stock === 0">
                  <i class="fas fa-shopping-cart me-1"></i> Al Carrito
                </button>


              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Modal Detalles del Producto -->
      <div class="modal fade" id="productoModal" tabindex="-1" aria-labelledby="productoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title fw-bold" id="productoModalLabel">{{ productoSeleccionado?.nombre }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body d-md-flex gap-4">
              <!-- Imagen -->
              <div class="flex-shrink-0 mb-3 mb-md-0 text-center">
                <img *ngIf="productoSeleccionado?.base64Img; else noImg"
                  [src]="'data:image/png;base64,' + productoSeleccionado?.base64Img" alt="Imagen producto"
                  style="max-width: 300px;" class="img-fluid rounded shadow-sm" />
                <ng-template #noImg>
                  <img [src]="'assets/productos/P' + productoSeleccionado?.idProducto + '.jpg'" alt="Imagen producto"
                    (error)="onImageError($event)" style="max-width: 300px;" class="img-fluid rounded shadow-sm" />
                </ng-template>

              </div>

              <!-- Detalles del producto -->
              <div class="flex-grow-1">
                <p class="text-muted">{{ productoSeleccionado?.descripcion }}</p>
                <p><strong>Categoría:</strong> {{ productoSeleccionado?.categoria.descripcion }}</p>
                <p class="fs-4 fw-bold titulos-Primary">S/. {{ productoSeleccionado?.precio | number:'1.2-2' }}</p>

                <!-- Cantidad -->
                <div class="mb-3 d-flex align-items-center gap-2">
                  <label for="cantidadInput" class="form-label mb-0">Cantidad:</label>
                  <div class="input-group" style="width: 120px;">
                    <button class="btn btn-outline-secondary btn-sm" type="button"
                      (click)="cambiarCantidad(-1)">-</button>
                    <input type="number" class="form-control form-control-sm text-center" id="cantidadInput"
                      [(ngModel)]="cantidadSeleccionada" min="1" />
                    <button class="btn btn-outline-secondary btn-sm" type="button"
                      (click)="cambiarCantidad(1)">+</button>
                  </div>
                </div>
                <div *ngIf="productoSeleccionado?.stock === 0" class="alert alert-warning p-2 text-center">
                  Este producto está agotado.
                </div>

                <!-- Botones -->
                <button class="btn btn-primary-custom w-100" (click)="agregarAlCarrito(productoSeleccionado)"
                  [disabled]="productoSeleccionado?.stock === 0">
                  <i class="fas fa-cart-plus me-2"></i>Agregar al carrito
                </button>

              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Paginación -->
      <nav *ngIf="totalPaginas > 1" aria-label="Paginación productos" class="mt-4">
        <ul class="pagination justify-content-center gap-1 pagination-lg">
          <!-- Botón Anterior -->
          <li class="page-item" [class.disabled]="paginaActual === 0">
            <button class="page-link" (click)="irAPagina(paginaActual - 1)" aria-label="Anterior"
              [attr.aria-disabled]="paginaActual === 0" title="Página anterior">
              <span aria-hidden="true">&laquo;</span>
            </button>
          </li>

          <!-- Números de página -->
          <li class="page-item" *ngFor="let _ of [].constructor(totalPaginas); let i = index"
            [class.active]="i === paginaActual" [attr.aria-current]="i === paginaActual ? 'page' : null">
            <button class="page-link" (click)="irAPagina(i)" [attr.aria-label]="'Página ' + (i + 1)"
              [attr.aria-current]="i === paginaActual ? 'page' : null" title="Ir a página {{ i + 1 }}">
              {{ i + 1 }}
            </button>
          </li>

          <!-- Botón Siguiente -->
          <li class="page-item" [class.disabled]="paginaActual === totalPaginas - 1">
            <button class="page-link" (click)="irAPagina(paginaActual + 1)" aria-label="Siguiente"
              [attr.aria-disabled]="paginaActual === totalPaginas - 1" title="Página siguiente">
              <span aria-hidden="true">&raquo;</span>
            </button>
          </li>
        </ul>
      </nav>

    </section>
  </div>
</div>